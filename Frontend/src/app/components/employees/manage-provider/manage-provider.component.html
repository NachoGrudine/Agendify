<!-- Close Button - Top Right -->
<button type="button" class="btn-close-sidebar" (click)="onClose()">
  <i-lucide [img]="XIcon" [size]="24"></i-lucide>
</button>

<!-- Provider Header -->
<div class="provider-header">
  <div class="provider-avatar">
    <i-lucide [img]="UserIcon" [size]="28"></i-lucide>
  </div>
  <div class="provider-info">
    <h2>{{ provider.name }}</h2>
    <p class="specialty">{{ provider.specialty }}</p>
  </div>
</div>

<!-- Tabs Navigation -->
<div class="tabs-navigation">
  <button
    type="button"
    class="tab-btn"
    [class.active]="activeTab() === 'profile'"
    (click)="setActiveTab('profile')"
  >
    Perfil
  </button>
  <button
    type="button"
    class="tab-btn"
    [class.active]="activeTab() === 'schedule'"
    (click)="setActiveTab('schedule')"
  >
    Disponibilidad
  </button>
</div>

<!-- Tab Content -->
<div class="tab-content-wrapper">
  <!-- Profile Tab -->
  @if (activeTab() === 'profile') {
    <div class="profile-content">
      <!-- Messages -->
      @if (successMessage()) {
        <div class="alert alert-success">
          <i-lucide [img]="CheckCircleIcon" [size]="18"></i-lucide>
          <span>{{ successMessage() }}</span>
        </div>
      }

      @if (errorMessage()) {
        <div class="alert alert-error">
          <i-lucide [img]="XCircleIcon" [size]="18"></i-lucide>
          <span>{{ errorMessage() }}</span>
        </div>
      }

      <!-- Profile Section -->
      <div class="profile-section">
        <h3 class="section-label">INFORMACIÓN DEL EMPLEADO</h3>

        <div class="form-field">
          <label class="field-label">Nombre Completo</label>
          <div class="input-with-icon">
            <i-lucide [img]="UserIcon" [size]="18" class="input-icon"></i-lucide>
            <input
              type="text"
              class="text-input"
              placeholder="Luciana Fernandez"
              [(ngModel)]="providerForm().name"
              (ngModelChange)="updateFormField('name', $event)"
            />
          </div>
        </div>

        <div class="form-field">
          <label class="field-label">Especialidad / Rol</label>
          <div class="input-with-icon">
            <i-lucide [img]="BriefcaseIcon" [size]="18" class="input-icon"></i-lucide>
            <input
              type="text"
              class="text-input"
              placeholder="Colorista"
              [(ngModel)]="providerForm().specialty"
              (ngModelChange)="updateFormField('specialty', $event)"
            />
          </div>
        </div>

        <div class="checkbox-field">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [checked]="providerForm().isActive"
              (change)="updateFormField('isActive', $any($event.target).checked)"
            />
            <span class="checkbox-text">Empleado activo</span>
          </label>
          <p class="field-hint">
            Los empleados inactivos no aparecerán en las asignaciones de citas pero su historial se mantendrá.
          </p>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-save" (click)="updateProvider()" [disabled]="isSaving()">
            <i-lucide [img]="SaveIcon" [size]="18"></i-lucide>
            @if (isSaving()) {
              <span>Guardando...</span>
            } @else {
              <span>Guardar Cambios</span>
            }
          </button>
        </div>
      </div>

      <!-- Danger Zone -->
      <div class="danger-zone">
        <h3 class="danger-label">ZONA PELIGROSA</h3>
        <p class="danger-text">
          Eliminar este empleado es una acción permanente y no se puede deshacer. Se eliminarán todas las configuraciones asociadas a este perfil.
        </p>
        <button type="button" class="btn-delete-danger" (click)="deleteProvider()">
          <i-lucide [img]="TrashIcon" [size]="18"></i-lucide>
          Eliminar Empleado
        </button>
      </div>
    </div>
  }

  <!-- Schedule Tab -->
  @if (activeTab() === 'schedule') {
    <div class="schedule-content">
      <!-- Schedule Header -->
      <div class="schedule-header">
        <div class="header-info">
          <h3>HORARIO SEMANAL</h3>
          @if (hasUnsavedScheduleChanges()) {
            <span class="unsaved-badge">Cambios sin guardar</span>
          }
        </div>
        <div class="header-buttons">
          @if (hasUnsavedScheduleChanges()) {
            <button type="button" class="btn-outline" (click)="discardSchedule()" [disabled]="isSaving()">
              Descartar
            </button>
          }
          <button
            type="button"
            class="btn-primary"
            (click)="saveSchedule()"
            [disabled]="isSaving() || hasValidationErrors() || !hasUnsavedScheduleChanges()"
          >
            @if (isSaving()) {
              <span>Guardando...</span>
            } @else {
              <span>Guardar Cambios</span>
            }
          </button>
        </div>
      </div>

      <!-- Messages -->
      @if (successMessage()) {
        <div class="alert alert-success">
          <i-lucide [img]="CheckCircleIcon" [size]="18"></i-lucide>
          <span>{{ successMessage() }}</span>
        </div>
      }

      @if (errorMessage()) {
        <div class="alert alert-error">
          <i-lucide [img]="XCircleIcon" [size]="18"></i-lucide>
          <span>{{ errorMessage() }}</span>
        </div>
      }

      <!-- Days List -->
      <div class="days-list">
        @for (day of weekSchedule(); track day.dayOfWeek; let dayIndex = $index) {
          <div class="day-card">
            <!-- Day Header -->
            <div class="day-header" (click)="toggleDay(dayIndex)">
              <div class="day-info">
                <span class="day-name">{{ day.dayName }}</span>
                <label class="toggle-switch" (click)="$event.stopPropagation()">
                  <input
                    type="checkbox"
                    [checked]="day.isOpen"
                    (change)="toggleDay(dayIndex)"
                  />
                  <span class="slider"></span>
                </label>
              </div>
              <button
                type="button"
                class="btn-copy"
                (click)="$event.stopPropagation(); copyToAll(dayIndex)"
                [disabled]="!day.isOpen"
                title="Copiar a todos"
              >
                <i-lucide [img]="CopyIcon" [size]="16"></i-lucide>
              </button>
            </div>

            <!-- Day Content -->
            @if (day.isOpen) {
              <div class="day-slots">
                @for (slot of day.slots; track $index; let slotIndex = $index) {
                  <div class="time-slot">
                    <input
                      type="time"
                      [value]="slot.start"
                      (change)="updateSlot(dayIndex, slotIndex, 'start', $any($event.target).value)"
                      class="time-input"
                      [class.error]="!isValidTimeRange(slot)"
                    />
                    <span class="time-separator">—</span>
                    <input
                      type="time"
                      [value]="slot.end"
                      (change)="updateSlot(dayIndex, slotIndex, 'end', $any($event.target).value)"
                      class="time-input"
                      [class.error]="!isValidTimeRange(slot)"
                    />
                    <button
                      type="button"
                      class="btn-remove"
                      (click)="removeSlot(dayIndex, slotIndex)"
                    >
                      <i-lucide [img]="TrashIcon" [size]="16"></i-lucide>
                    </button>
                  </div>
                  @if (!isValidTimeRange(slot)) {
                    <span class="error-text">⚠️ Hora de inicio debe ser menor que hora de fin</span>
                  }
                }
                <button
                  type="button"
                  class="btn-add-slot"
                  (click)="addSlot(dayIndex)"
                >
                  <i-lucide [img]="PlusIcon" [size]="14"></i-lucide>
                  Agregar horario
                </button>
              </div>
            } @else {
              <div class="day-closed">
                <span>No disponible</span>
              </div>
            }
          </div>
        }
      </div>

      <!-- Bottom Actions -->
      <div class="bottom-actions">
        <button type="button" class="btn-cancel" (click)="onClose()">
          Cancelar
        </button>
        <button
          type="button"
          class="btn-save-bottom"
          (click)="saveSchedule()"
          [disabled]="isSaving() || hasValidationErrors() || !hasUnsavedScheduleChanges()"
        >
          @if (isSaving()) {
            <span>Guardando...</span>
          } @else {
            <span>Guardar Cambios</span>
          }
        </button>
      </div>
    </div>
  }
</div>
