<app-toast />

<div class="clientes-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <div class="header-icon">
        <i-lucide [img]="UsersIcon" [size]="32"></i-lucide>
      </div>
      <div class="header-title-section">
        <h1>Gestión de Clientes</h1>
        <p class="subtitle">Administra la información de tus clientes</p>
      </div>
    </div>
    <app-button
      label="Nuevo Cliente"
      severity="primary"
      [iconStart]="UserPlusIcon"
      (onClick)="onCreateCustomer()"
    />
  </div>

  <!-- Buscador -->
  <div class="search-section">
    <app-input
      inputId="searchCustomer"
      placeholder="Buscar cliente por nombre, email o teléfono..."
      [(ngModel)]="searchTerm"
      (ngModelChange)="onSearch()"
      [iconStart]="SearchIcon"
      type="text"
    />
  </div>

  <!-- Tabla de clientes -->
  <div class="table-section" *ngIf="!isLoading()">
    <app-table
      [data]="paginatedCustomers()"
      [columns]="tableColumns"
      [actions]="tableActions"
      [emptyMessage]="searchTerm() ? 'No se encontraron clientes' : 'No hay clientes registrados'"
    />

    <!-- Pagination -->
    @if (filteredCustomers().length > 0) {
      <div class="pagination">
        <div class="pagination-left">
          <div class="pagination-info">
            Mostrando
            <strong>{{ ((currentPage() - 1) * pageSize()) + 1 }}</strong>
            a
            <strong>{{ currentPage() * pageSize() > filteredCustomers().length ? filteredCustomers().length : currentPage() * pageSize() }}</strong>
            de
            <strong>{{ filteredCustomers().length }}</strong>
            clientes
          </div>
          <div class="page-size-selector">
            <label for="page-size">Mostrar:</label>
            <select
              id="page-size"
              [ngModel]="pageSize()"
              (ngModelChange)="changePageSize($event)"
            >
              <option *ngFor="let size of pageSizeOptions" [ngValue]="size">{{ size }}</option>
            </select>
            <span>por página</span>
          </div>
        </div>

        <div class="pagination-controls">
          <button
            class="btn-page btn-nav"
            (click)="previousPage()"
            [disabled]="!hasPreviousPage()"
            title="Página anterior"
          >
            <span>&lsaquo;</span>
          </button>

          <button
            *ngFor="let page of getPageNumbers()"
            class="btn-page btn-number"
            [class.active]="page === currentPage()"
            (click)="goToPage(page)"
            [title]="'Ir a página ' + page"
          >{{ page }}</button>

          <button
            class="btn-page btn-nav"
            (click)="nextPage()"
            [disabled]="!hasNextPage()"
            title="Página siguiente"
          >
            <span>&rsaquo;</span>
          </button>
        </div>
      </div>
    }
  </div>

  <!-- Loading state -->
  <div class="loading-state" *ngIf="isLoading()">
    <div class="spinner"></div>
    <p>Cargando clientes...</p>
  </div>
</div>

<!-- Dialog de formulario (Crear/Editar) -->
<app-dialog
  [(visible)]="showFormDialog"
  [width]="'520px'"
  [footerTemplate]="true"
>
  <!-- Header Custom -->
  <div class="modal-header">
    <div class="header-left">
      <i-lucide [img]="UserPlusIcon" [size]="22" class="header-icon"></i-lucide>
      <h2 class="modal-title">{{ getDialogTitle() }}</h2>
    </div>
  </div>

  <!-- Form Body -->
  <div class="modal-body">
    <!-- Nombre -->
    <div class="form-section">
      <app-input
        inputId="customerName"
        label="NOMBRE COMPLETO"
        type="text"
        placeholder="Ej. Juan Pérez"
        [(ngModel)]="customerName"
        name="customerName"
        [required]="true"
        [error]="errors().name"
      />
    </div>

    <!-- Teléfono -->
    <div class="form-section">
      <app-input
        inputId="customerPhone"
        label="TELÉFONO"
        type="tel"
        placeholder="Ej. +54 11 1234-5678"
        [(ngModel)]="customerPhone"
        name="customerPhone"
        [iconStart]="PhoneIcon"
        [error]="errors().phone"
      />
    </div>

    <!-- Email -->
    <div class="form-section">
      <app-input
        inputId="customerEmail"
        label="EMAIL"
        type="email"
        placeholder="Ej. cliente@example.com"
        [(ngModel)]="customerEmail"
        name="customerEmail"
        [iconStart]="MailIcon"
        [error]="errors().email"
      />
    </div>
  </div>

  <!-- Footer Actions -->
  <div dialogFooter class="modal-footer">
    <app-button
      label="Cancelar"
      severity="outlined"
      (onClick)="cancelForm()"
      [disabled]="isSaving()"
    />
    <app-button
      [label]="isEditMode() ? 'Guardar Cambios' : 'Crear Cliente'"
      severity="primary"
      (onClick)="onSubmit()"
      [loading]="isSaving()"
    />
  </div>
</app-dialog>

