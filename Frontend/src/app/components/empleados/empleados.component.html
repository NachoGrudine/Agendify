<div class="empleados-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <div class="header-icon">
        <i-lucide [img]="BriefcaseIcon" [size]="32"></i-lucide>
      </div>
      <div class="header-title-section">
        <h1>Gestión de Empleados</h1>
        <p class="subtitle">Administra el acceso y disponibilidad de tu personal</p>
      </div>
    </div>
    <app-button
      label="Nuevo Miembro"
      severity="primary"
      [iconStart]="PlusIcon"
      (onClick)="openCreateDialog()"
    />
  </div>

  <!-- Buscador -->
  <div class="search-section">
    <app-input
      inputId="searchProvider"
      placeholder="Buscar miembro por nombre o especialidad..."
      [(ngModel)]="searchTerm"
      [iconStart]="SearchIcon"
      type="text"
    />
  </div>

  <!-- Messages -->
  @if (successMessage()) {
    <div class="alert alert-success">
      <i-lucide [img]="CheckCircleIcon" [size]="20"></i-lucide>
      <span>{{ successMessage() }}</span>
    </div>
  }

  @if (errorMessage()) {
    <div class="alert alert-error">
      <i-lucide [img]="XCircleIcon" [size]="20"></i-lucide>
      <span>{{ errorMessage() }}</span>
    </div>
  }

  <!-- Loading State -->
  @if (isLoading()) {
    <app-loading-spinner message="Cargando empleados..." />
  } @else {
    <!-- Providers Grid -->
    <div class="providers-grid">
      @for (provider of filteredProviders(); track provider.id) {
        <app-card customClass="provider-card">
          <!-- Card Header -->
          <div class="provider-header">
            <div class="provider-avatar">
              <i-lucide [img]="UserIcon" [size]="28"></i-lucide>
              @if (provider.isActive) {
                <span class="status-indicator active"></span>
              }
            </div>
            <div class="provider-info">
              <h3>{{ provider.name }}</h3>
              <p class="specialty">{{ provider.specialty }}</p>
              @if (provider.isActive) {
                <span class="badge badge-active">Activo</span>
              } @else {
                <span class="badge badge-inactive">Inactivo</span>
              }
            </div>
          </div>

          <!-- Manage Button -->
          <button class="btn-manage" (click)="openManageDialog(provider)">
            <i-lucide [img]="BriefcaseIcon" [size]="18"></i-lucide>
            <span>Gestionar</span>
          </button>
        </app-card>
      }

      @if (filteredProviders().length === 0 && !searchTerm()) {
        <div class="empty-state">
          <i-lucide [img]="BriefcaseIcon" [size]="64" [strokeWidth]="1"></i-lucide>
          <h3>No hay empleados registrados</h3>
          <p>Comienza agregando tu primer miembro del equipo</p>
          <app-button
            label="Agregar Empleado"
            severity="primary"
            [iconStart]="PlusIcon"
            (onClick)="openCreateDialog()"
          />
        </div>
      }

      @if (filteredProviders().length === 0 && searchTerm()) {
        <div class="empty-state">
          <i-lucide [img]="SearchIcon" [size]="64" [strokeWidth]="1"></i-lucide>
          <h3>No se encontraron resultados</h3>
          <p>Intenta con otros términos de búsqueda</p>
        </div>
      }
    </div>
  }
</div>

<!-- Create Provider Dialog -->
<app-dialog
  [visible]="showProviderDialog()"
  [width]="'600px'"
  [closable]="true"
  [modal]="true"
  (onHide)="closeProviderDialog()"
>
  <div class="dialog-content">
    <!-- Header (con icono) -->
    <div class="create-dialog-header">
      <div class="create-dialog-header-left">
        <div class="create-dialog-icon">
          <i-lucide [img]="UserPlusIcon" [size]="20"></i-lucide>
        </div>
        <div class="create-dialog-titles">
          <h3 class="create-dialog-title">Nuevo Miembro del Equipo</h3>
          <p class="create-dialog-subtitle">Agregá un nuevo empleado a tu negocio</p>
        </div>
      </div>

      <button type="button" class="create-dialog-close" (click)="closeProviderDialog()">
        <i-lucide [img]="XIcon" [size]="18"></i-lucide>
      </button>
    </div>

    <!-- Messages -->
    @if (successMessage()) {
      <div class="alert alert-success">
        <i-lucide [img]="CheckCircleIcon" [size]="18"></i-lucide>
        <span>{{ successMessage() }}</span>
      </div>
    }

    @if (errorMessage()) {
      <div class="alert alert-error">
        <i-lucide [img]="XCircleIcon" [size]="18"></i-lucide>
        <span>{{ errorMessage() }}</span>
      </div>
    }

    <!-- Form Fields -->
    <div class="form-field">
      <app-input
        inputId="providerName"
        label="NOMBRE COMPLETO"
        placeholder="Nombre del empleado"
        [(ngModel)]="providerForm().name"
        (ngModelChange)="updateFormField('name', $event)"
        [iconStart]="UserIcon"
      />
    </div>

    <div class="form-field">
      <app-input
        inputId="providerSpecialty"
        label="ESPECIALIDAD / ROL"
        placeholder="Ej: Barbero, Estilista, Recepción"
        [(ngModel)]="providerForm().specialty"
        (ngModelChange)="updateFormField('specialty', $event)"
        [iconStart]="BriefcaseIcon"
      />
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <app-button
        label="Cancelar"
        severity="secondary"
        (onClick)="closeProviderDialog()"
        [disabled]="isSaving()"
      />
      <app-button
        label="Crear Empleado"
        severity="primary"
        [iconStart]="SaveIcon"
        (onClick)="saveProvider()"
        [loading]="isSaving()"
        [disabled]="isSaving()"
      />
    </div>
  </div>
</app-dialog>

<!-- Manage Dialog - Ahora usa el subcomponente como sidebar -->
<app-dialog
  [visible]="showManageDialog()"
  [width]="'900px'"
  [closable]="false"
  [modal]="true"
  customClass="sidebar-dialog"
  (onHide)="closeManageDialog()"
>
  @if (currentProvider()) {
    <app-manage-provider
      [provider]="currentProvider()!"
      (providerUpdated)="onProviderUpdated($event)"
      (providerDeleted)="onProviderDeleted($event)"
      (close)="closeManageDialog()"
    />
  }
</app-dialog>
